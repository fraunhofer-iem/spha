# This is the component definition
spec:
  inputs:
    stage:
      description: ""
      default: "test"
    server_url:
      default: "http://spha:8080/api/report"
      description: "The SPHA server endpoint to POST the result"
    tool_result_dir:
      default: "."
      description: "The directory containing tool result JSON files"

---
run-spha-cli:
  # Use the stage passed in by the consuming pipeline
  stage: $[[ inputs.stage ]]
  image: eclipse-temurin:25-jdk-alpine
  tags: ["shared"]
  needs: ["osv-scanner", "trufflehog"]
  variables:


  before_script:
    # Ensure git is installed
    - apk update && apk add git

  script:
    # Clone the components repo into a temporary directory
    - echo "Cloning component repository..."
    - git clone "http://gitlab.spha.demo/spah/spa-component.git" comp-repo
    - ./comp-repo/artifacts/spha-cli/bin/spha-cli analyze --reportUri "$[[ inputs.server_url ]]" --toolResultDir "$[[ inputs.tool_result_dir ]]"
